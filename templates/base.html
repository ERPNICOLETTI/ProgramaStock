<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMS Stock PC</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f4f6f8; color: #333; }
        
        nav { background: #2c3e50; padding: 0 30px; height: 70px; color: white; display: flex; gap: 20px; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        nav a { color: white; text-decoration: none; font-weight: 600; font-size: 1.1rem; padding: 10px 15px; border-radius: 6px; transition: background 0.2s; display: flex; align-items: center; gap: 8px; position: relative; }
        nav a:hover { background: #34495e; }
        
        .content { padding-top: 20px; }
        .container { padding: 30px; max-width: 1200px; margin: 0 auto; }
        
        .btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 1rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; transition: transform 0.1s; }
        .btn:active { transform: translateY(1px); }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e1e4e8; }
        input { padding: 12px; border: 2px solid #dfe6e9; border-radius: 6px; font-size: 16px; width: 100%; }
        input:focus { border-color: #3498db; outline: none; }

        /* NOTIFICACI√ìN ROJA */
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #e74c3c;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 50%;
            display: none; /* Se oculta si es 0 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <nav>
        <span style="font-size: 1.5rem; margin-right: auto; display: flex; align-items: center; gap: 10px;">
            üì¶ WMS <small style="font-size: 0.8rem; opacity: 0.7;">v2.1</small>
        </span>
        
        <a href="/ordenes/">üìã √ìrdenes</a>
        <a href="/stock/" style="background: #0dcaf0; color: #000; border: 1px solid #0aa2c0;">
            üîç Stock
        </a>
        <a href="/transferencias/" style="background: #f1c40f; color: #333;">üöõ Transferencia</a>
        <a href="/ingresos/" style="background: #27ae60; color: white;">üì• Ingresos</a>
        <a href="/egresos/" style="background: #c0392b; color: white;">üì§ Egresos</a>
        
        <a href="/ordenes/admin/despacho" style="margin-left: 20px; background: transparent; border: 1px solid #7f8c8d;">
            üîê
            <span id="admin-badge" class="notification-badge">0</span>
        </a>
    </nav>
    
    <div class="content">
        {% block content %}{% endblock %}
    </div>

    <script>
        let lastCount = 0;
        const audioNotif = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg'); 
        // Puedes cambiar la URL por un archivo local si prefieres

        function checkNuevasOrdenes() {
            fetch('/ordenes/api/check-pendientes-admin')
                .then(response => response.json())
                .then(data => {
                    const count = data.count;
                    const badge = document.getElementById('admin-badge');
                    
                    if (count > 0) {
                        badge.style.display = 'block';
                        badge.innerText = count;
                        document.title = `(${count}) üì¶ WMS Stock`; // Cambia t√≠tulo de pesta√±a
                        
                        // Si aument√≥ la cantidad, sonar alerta
                        if (count > lastCount) {
                            try { audioNotif.play(); } catch(e) { console.log("Audio bloqueado por navegador"); }
                        }
                    } else {
                        badge.style.display = 'none';
                        document.title = "WMS Stock PC";
                    }
                    
                    lastCount = count;
                })
                .catch(err => console.error("Error polling:", err));
        }

        // Revisar cada 10 segundos
        setInterval(checkNuevasOrdenes, 10000);
        
        // Revisar al cargar
        checkNuevasOrdenes();
    </script>
</body>
</html>